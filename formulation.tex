\documentclass{article}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{geometry}
\geometry{a4paper, margin=1in}

\title{GCS Path Planning: SDP Relaxation and Formulation}
\author{Antigravity}
\date{\today}

\begin{document}

\maketitle

\section{Introduction}
This document details the mathematical formulation for the Graph of Convex Sets (GCS) path planning algorithm, specifically focusing on the Semidefinite Programming (SDP) relaxation used to minimize the L2 norm of the trajectory velocity.

\section{Convex Decomposition}
The goal is to decompose the free space $\mathcal{F} = \mathcal{W} \setminus \bigcup_{j=1}^M \mathcal{O}_j$, where $\mathcal{W}$ is the rectangular domain and $\mathcal{O}_j$ are convex obstacles, into a set of convex polygons $\{R_1, \dots, R_N\}$.

\subsection{Hole Integration}
Since the free space is multiply-connected (contains holes), we first transform it into a simply-connected polygon $P$.
\begin{enumerate}
    \item Let $P_0$ be the boundary of $\mathcal{W}$ (ordered Counter-Clockwise).
    \item For each obstacle $\mathcal{O}_j$ (ordered Clockwise):
    \begin{itemize}
        \item Find a "bridge" connecting a vertex $v \in \mathcal{O}_j$ to a visible vertex $u \in P_{current}$.
        \item Insert the sequence of $\mathcal{O}_j$ vertices into $P_{current}$ at $u$, effectively merging the hole into the boundary.
    \end{itemize}
    \item The result is a single polygon $P$ (possibly with self-touching edges) that represents $\mathcal{F}$.
\end{enumerate}

\subsection{Partitioning}
We decompose $P$ into convex regions using a heuristic approach based on resolving reflex vertices (vertices with internal angle $> 180^\circ$).

\textbf{Algorithm: Convex Decomposition}
\begin{enumerate}
    \item Initialize $Regions \gets \emptyset$.
    \item While $P$ is not convex:
    \begin{enumerate}
        \item Find a diagonal $d = (v_i, v_k)$ such that:
        \begin{itemize}
            \item The polygon formed by $v_i, \dots, v_k$ is convex.
            \item The diagonal $d$ does not intersect any other edges of $P$.
            \item No other vertices of $P$ lie inside the formed polygon.
        \end{itemize}
        \item Let $C = \{v_i, \dots, v_k\}$.
        \item $Regions \gets Regions \cup \{C\}$.
        \item $P \gets P \setminus C$ (Update boundary of $P$).
    \end{enumerate}
    \item $Regions \gets Regions \cup \{P\}$.
\end{enumerate}

\section{Trajectory Optimization (SDP Relaxation)}

We solve a relaxed version of the GCS problem using Semidefinite Programming (SDP). The binary variables are relaxed to continuous variables, resulting in a "flow" solution rather than a discrete path.

\subsection{Sets and Indices}
\begin{itemize}
    \item $V$: Set of convex regions (polygons), indexed by $i$.
    \item $E$: Set of edges $(i, j)$ representing adjacency between region $i$ and $j$.
    \item $K$: Degree of the B\'ezier curve (we use $K=2$ for quadratic).
    \item $d$: Dimension ($d=2$).
\end{itemize}

\subsection{Variables}
\begin{itemize}
    \item $y_i \in [0, 1]$: Continuous variable representing the activation of region $i$.
    \item $z_{ij} \in [0, 1]$: Continuous variable representing the flow from region $i$ to $j$.
    \item $x_{i,k} \in \mathbb{R}^2$: Control point $k$ ($k \in \{0, \dots, K\}$) for the B\'ezier curve in region $i$.
    \item $t_{i,k} \in \mathbb{R}$: Slack variable for the L2 norm of the velocity vector.
\end{itemize}

\subsection{Optimization Problem}

The objective is to minimize the sum of the L2 norms of the velocity vectors (path length approximation).

\begin{equation*}
\min \sum_{i \in V} \sum_{k=1}^K t_{i,k}
\end{equation*}

\noindent \textbf{Subject to:}

\subsubsection*{1. Flow Conservation}
Standard network flow constraints adapted for the relaxed variables:
\begin{align*}
& \sum_{j: (s,j) \in E} z_{sj} - \sum_{j: (j,s) \in E} z_{js} = 1 \quad (\text{Start Node } s) \\
& \sum_{j: (g,j) \in E} z_{gj} - \sum_{j: (j,g) \in E} z_{jg} = -1 \quad (\text{Goal Node } g) \\
& \sum_{j: (i,j) \in E} z_{ij} - \sum_{j: (j,i) \in E} z_{ji} = 0 \quad \forall i \in V \setminus \{s, g\} \\
& y_i \ge \sum_{j} z_{ij}, \quad y_i \ge \sum_{j} z_{ji}
\end{align*}

\subsubsection*{2. L2 Norm via Schur Complement (SDP)}
We want to enforce $t_{i,k} \ge \|v_{i,k}\|_2$, where $v_{i,k} = x_{i,k} - x_{i,k-1}$. This is equivalent to $t_{i,k}^2 \ge v_{i,k}^T v_{i,k}$ (for $t_{i,k} \ge 0$).
Using the Schur Complement, this can be written as a Linear Matrix Inequality (LMI):
\begin{equation*}
\begin{pmatrix}
t_{i,k} I_d & v_{i,k} \\
v_{i,k}^T & t_{i,k}
\end{pmatrix} \succeq 0
\end{equation*}
where $I_d$ is the $d \times d$ identity matrix.

\subsubsection*{3. Containment}
\begin{align*}
& A_i x_{i,k} \le b_i + M(1 - y_i) \quad \forall i \in V, k \in \{0,\dots,K\} \\
& -M y_i \le x_{i,k} \le M y_i \quad (\text{Force } x_{i,k}=0 \text{ if } y_i=0)
\end{align*}

\subsubsection*{4. Continuity ($C^0$)}
\begin{equation*}
\| x_{i,K} - x_{j,0} \|_\infty \le M(1 - z_{ij}) \quad \forall (i,j) \in E
\end{equation*}

\subsubsection*{5. Heading Consistency ($C^1$)}
\begin{equation*}
\| (x_{i,K} - x_{i,K-1}) - (x_{j,1} - x_{j,0}) \|_\infty \le M(1 - z_{ij}) \quad \forall (i,j) \in E
\end{equation*}

\subsubsection*{6. Boundary Conditions}
\begin{equation*}
x_{s,0} = p_{\text{start}}, \quad x_{g,K} = p_{\text{goal}}
\end{equation*}

\vspace{1em}
\noindent \textbf{Note}: $M$ is a sufficiently large constant ("Big-M"). The relaxation allows the problem to be solved by convex solvers like SCS, which support PSD cones but not integer variables. The result is a flow indicating the optimal path.

\end{document}
